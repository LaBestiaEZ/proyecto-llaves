<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-5">
    <h1 class="h2 fw-bold text-uppercase">Administrar <span class="text-primary">Productos</span></h1>
    <button (click)="openModal()" class="btn btn-primary d-flex align-items-center gap-2">
      <i class="bi bi-plus-lg"></i> Nuevo Producto
    </button>
  </div>

  @if (loading()) {
  <app-loading-spinner message="Cargando inventario..."></app-loading-spinner>
  } @else {
  <div class="glass-pane overflow-hidden">
    <div class="table-responsive">
      <table class="table table-dark table-hover mb-0" style="background: transparent;">
        <thead>
          <tr>
            <th class="py-3 px-4 text-secondary text-uppercase small">ID</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Marca</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Modelo</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Año</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Precio</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Stock</th>
            <th class="py-3 px-4 text-secondary text-uppercase small text-end">Acciones</th>
          </tr>
        </thead>
        <tbody class="border-top border-secondary border-opacity-25">
          @for (product of products(); track product.id) {
          <tr>
            <td class="py-3 px-4 align-middle font-monospace text-secondary">{{ product.id }}</td>
            <td class="py-3 px-4 align-middle fw-bold">{{ product.brand }}</td>
            <td class="py-3 px-4 align-middle">{{ product.model }}</td>
            <td class="py-3 px-4 align-middle">{{ product.year }}</td>
            <td class="py-3 px-4 align-middle text-primary fw-bold">{{ product.price }}€</td>
            <td class="py-3 px-4 align-middle">
              <span
                [class]="'badge ' + (product.stock > 5 ? 'bg-success' : product.stock > 0 ? 'bg-warning' : 'bg-danger') + ' bg-opacity-25 text-white border border-' + (product.stock > 5 ? 'success' : product.stock > 0 ? 'warning' : 'danger')">
                {{ product.stock }}
              </span>
            </td>
            <td class="py-3 px-4 align-middle text-end">
              <button (click)="openModal(product)" class="btn btn-sm btn-outline-info me-2" title="Editar">
                <i class="bi bi-pencil"></i>
              </button>
              <button (click)="deleteProduct(product.id!)" class="btn btn-sm btn-outline-danger" title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  }

  <!-- Modal -->
  @if (showModal()) {
  <div class="modal fade show d-block admin-products-modal-backdrop" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content glass-pane border-0">
      <div class="modal-content glass-pane border-0">
        <div class="modal-header border-bottom border-secondary border-opacity-25">
          <h5 class="modal-title fw-bold text-uppercase">
            <i class="bi bi-box-seam me-2 text-primary"></i>
            {{ editingProduct() ? 'Editar Producto' : 'Nuevo Producto' }}
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
        </div>
        <div class="modal-body p-4">
          <form (ngSubmit)="saveProduct()" id="productForm">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input [(ngModel)]="formData.brand" name="brand" type="text" required class="form-control" id="brand"
                    placeholder="Marca">
                  <label for="brand" class="text-secondary">Marca</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input [(ngModel)]="formData.model" name="model" type="text" required class="form-control" id="model"
                    placeholder="Modelo">
                  <label for="model" class="text-secondary">Modelo</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input [(ngModel)]="formData.year" name="year" type="number" required class="form-control" id="year"
                    placeholder="Año">
                  <label for="year" class="text-secondary">Año</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input [(ngModel)]="formData.price" name="price" type="number" step="0.01" required
                    class="form-control" id="price" placeholder="Precio">
                  <label for="price" class="text-secondary">Precio (€)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input [(ngModel)]="formData.stock" name="stock" type="number" required class="form-control"
                    id="stock" placeholder="Stock">
                  <label for="stock" class="text-secondary">Stock</label>
                </div>
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <input [(ngModel)]="formData.imageUrl" name="imageUrl" type="text" class="form-control" id="imageUrl"
                    placeholder="URL de Imagen">
                  <label for="imageUrl" class="text-secondary">URL de Imagen</label>
                </div>
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <textarea [(ngModel)]="formData.description" name="description" style="height: 100px"
                    class="form-control" id="description" placeholder="Descripción"></textarea>
                  <label for="description" class="text-secondary">Descripción</label>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-top border-secondary border-opacity-25">
          <button type="button" (click)="closeModal()" class="btn btn-outline-secondary">
            Cancelar
          </button>
          <button type="submit" form="productForm" class="btn btn-primary px-4 fw-bold">
            <i class="bi bi-save me-2"></i> Guardar
          </button>
        </div>
      </div>
    </div>
  </div>
  }
</div>