<div class="container py-5">
  <h1 class="h2 fw-bold mb-4 text-uppercase">Carrito de <span class="text-primary">Compras</span></h1>

  @if (cartService.items().length === 0) {
  <div class="glass-pane p-5 text-center">
    <i class="bi bi-cart-x display-1 text-secondary mb-3"></i>
    <p class="lead text-secondary mb-4">Tu carrito está vacío</p>
    <a routerLink="/products" class="btn btn-primary btn-lg">
      <i class="bi bi-arrow-left me-2"></i> Ver productos
    </a>
  </div>
  } @else {
  <div class="row g-4">
    <!-- Lista de productos -->
    <div class="col-lg-8">
      <div class="d-grid gap-3">
        @for (item of cartService.items(); track item.product.id) {
        <div class="card glass-pane border-0">
          <div class="card-body p-3 d-flex flex-column flex-sm-row gap-4 align-items-center">
            <img [src]="item.product.imageUrl || 'https://via.placeholder.com/100'" [alt]="item.product.brand"
              class="rounded-3 border border-secondary" style="width: 100px; height: 100px; object-fit: cover;">
            <div class="flex-grow-1 text-center text-sm-start">
              <h3 class="h5 fw-bold mb-1 text-uppercase">{{ item.product.brand }} <span class="text-primary">{{
                  item.product.model }}</span></h3>
              <p class="text-secondary small mb-1">Año: {{ item.product.year }}</p>
              <p class="text-light fw-bold mb-0 fs-5">{{ item.product.price }}€</p>
            </div>
            <div class="d-flex flex-column align-items-center gap-2">
              <div class="btn-group border border-secondary rounded" role="group">
                <button type="button" (click)="updateQuantity(item.product.id!, item.quantity - 1)"
                  class="btn btn-outline-light btn-sm border-0">
                  <i class="bi bi-dash"></i>
                </button>
                <span class="btn btn-sm disabled text-white border-0"
                  style="width: 3rem; background: rgba(255,255,255,0.05)">
                  {{ item.quantity }}
                </span>
                <button type="button" (click)="updateQuantity(item.product.id!, item.quantity + 1)"
                  class="btn btn-outline-light btn-sm border-0" [disabled]="item.quantity >= item.product.stock">
                  <i class="bi bi-plus"></i>
                </button>
              </div>
              <button (click)="removeItem(item.product.id!)"
                class="btn btn-link text-danger text-decoration-none btn-sm">
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </div>
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Resumen del pedido -->
    <div class="col-lg-4">
      <div class="card glass-pane sticky-top " style="top: 80px;">
        <div class="card-body p-4">
          <h2 class="h4 fw-bold mb-4 card-title text-uppercase">Resumen</h2>

          <div class="mb-4">
            <div class="d-flex justify-content-between mb-2 text-secondary">
              <span>Productos ({{ cartService.itemCount() }})</span>
              <span>{{ cartService.total().toFixed(2) }}€</span>
            </div>
            <div class="d-flex justify-content-between fw-bold h4 border-top border-secondary pt-3 text-white">
              <span>Total</span>
              <span class="text-primary" style="text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);">{{
                cartService.total().toFixed(2) }}€</span>
            </div>
          </div>

          @if (orderMessage()) {
          <div
            [class]="orderSuccess() ? 'alert alert-success border-success text-success bg-success bg-opacity-10' : 'alert alert-danger border-danger text-danger bg-danger bg-opacity-10'"
            role="alert">
            {{ orderMessage() }}
          </div>
          }

          <div class="d-grid gap-3">
            <button (click)="checkout()" [disabled]="processing()"
              class="btn btn-info fw-bold py-3 text-uppercase shadow-lg text-dark border-0">
              @if(processing()) {
              <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Procesando...
              } @else {
              <i class="bi bi-credit-card me-2"></i> Realizar Pedido
              }
            </button>

            <button (click)="clearCart()" class="btn btn-outline-danger btn-sm">
              Vaciar Carrito
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>