<div class="container py-5">
  <h1 class="h2 fw-bold mb-5 text-uppercase">Gestión de <span class="text-primary">Citas</span></h1>

  @if (loading()) {
  <app-loading-spinner message="Cargando citas..."></app-loading-spinner>
  } @else {
  <div class="glass-pane overflow-hidden">
    <div class="table-responsive">
      <table class="table table-dark table-hover mb-0" style="background: transparent;">
        <thead>
          <tr>
            <th class="py-3 px-4 text-secondary text-uppercase small">ID</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Cliente</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Contacto</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Vehículo</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Servicio</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Fecha/Lugar</th>
            <th class="py-3 px-4 text-secondary text-uppercase small">Estado</th>
            <th class="py-3 px-4 text-secondary text-uppercase small text-end">Acciones</th>
          </tr>
        </thead>
        <tbody class="border-top border-secondary border-opacity-25">
          @for (appointment of appointments(); track appointment.id) {
          <tr>
            <td class="py-3 px-4 align-middle font-monospace text-secondary">{{ appointment.id }}</td>
            <td class="py-3 px-4 align-middle fw-bold">{{ appointment.customerName }}</td>
            <td class="py-3 px-4 align-middle">
              <div class="small">
                <div class="text-light mb-1"><i class="bi bi-envelope me-1"></i> {{ appointment.customerEmail }}</div>
                <div class="text-secondary"><i class="bi bi-telephone me-1"></i> {{ appointment.customerPhone }}</div>
              </div>
            </td>
            <td class="py-3 px-4 align-middle">
              <div class="fw-bold">{{ appointment.vehicleMake }} {{ appointment.vehicleModel }}</div>
              @if (appointment.vehicleYear) {
              <small class="text-secondary">{{ appointment.vehicleYear }}</small>
              }
            </td>
            <td class="py-3 px-4 align-middle">
              <div class="text-primary">{{ appointment.serviceType }}</div>
              @if (appointment.notes) {
              <small class="text-secondary d-block mt-1 text-truncate" style="max-width: 150px;"
                [title]="appointment.notes">
                <i class="bi bi-chat-text me-1"></i> {{ appointment.notes }}
              </small>
              }
            </td>
            <td class="py-3 px-4 align-middle">
              <div class="mb-1"><i class="bi bi-calendar-event me-1"></i> {{ appointment.appointmentDate | date:'short'
                }}</div>
              <small class="text-secondary"><i class="bi bi-geo-alt me-1"></i> {{ appointment.serviceAddress }}</small>
            </td>
            <td class="py-3 px-4 align-middle">
              <select [value]="appointment.status" (change)="onStatusChange($event, appointment.id!)"
                class="form-select form-select-sm bg-dark text-white border-secondary" [ngClass]="{
                    'border-warning text-warning': appointment.status === 'pending',
                    'border-info text-info': appointment.status === 'confirmed',
                    'border-primary text-primary': appointment.status === 'in_progress',
                    'border-success text-success': appointment.status === 'completed',
                    'border-danger text-danger': appointment.status === 'cancelled'
                  }" style="width: 140px;">
                <option value="pending">Pendiente</option>
                <option value="confirmed">Confirmada</option>
                <option value="in_progress">En Progreso</option>
                <option value="completed">Completada</option>
                <option value="cancelled">Cancelada</option>
              </select>
            </td>
            <td class="py-3 px-4 align-middle text-end">
              <button (click)="deleteAppointment(appointment.id!)" class="btn btn-sm btn-outline-danger"
                title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
          }
          @if (appointments().length === 0) {
          <tr>
            <td colspan="8" class="text-center py-5 text-secondary">
              <i class="bi bi-calendar-x display-6 d-block mb-3 opacity-50"></i>
              No hay citas registradas.
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  }

</div>